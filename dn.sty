\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{dynamicnumber}[2015/08/24 Dynamic Number package]

\RequirePackage{pgfkeys}
\RequirePackage{xparse}

% http://tex.stackexchange.com/questions/63223/xparse-empty-arguments
% test if argument is empty
% use: \@IfNoValueOrEmptyTF{argument}{if empty}{if not empty}
\ExplSyntaxOn
\DeclareExpandableDocumentCommand{\@IfNoValueOrEmptyTF}{mmm}
 {
  \IfNoValueTF{#1}{#2}
   {
    \tl_if_empty:nTF {#1} {#2} {#3}
   }
 }
\ExplSyntaxOff

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% internal functions                               %
% these functions should not be called by the user %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% define a new list of dynamic values
\DeclareDocumentCommand{\dndeclare}{m}{%
    \pgfkeys{%
        /dynamicnumber/#1/.is family,
        /dynamicnumber/#1/.unknown/.style = {\pgfkeyscurrentpath/\pgfkeyscurrentname/.initial = ##1}
    }%
}

% set current list of dynamic values
\DeclareDocumentCommand{\dnsetcurrent}{m}{%
	\@ifundefined{dncurrent}{%
		\DeclareDocumentCommand{\dncurrent}{}{#1}%
	}
	{%
		\RenewDocumentCommand{\dncurrent}{}{#1}%
	}%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%
% external functions     %
% primary user interface %
%%%%%%%%%%%%%%%%%%%%%%%%%%

% read dynamic number list from file
\DeclareDocumentCommand{\dnload}{m}{%
\newread\ccinstream
\immediate\openin\ccinstream=#1.dnlist
\@whilesw\unless\ifeof\ccinstream\fi{%
\immediate\read\ccinstream to \auxcommand
\auxcommand
}
\immediate\closein\ccinstream
}

% get a dynamic value
\DeclareDocumentCommand{\dnget}{O{} m}{%
\@IfNoValueOrEmptyTF{#1}{\pgfkeysvalueof{/dynamicnumber/\dncurrent/#2}}{\pgfkeysvalueof{/dynamicnumber/#1/#2}}%
}
\endinput

%% End of file `dynamicnumber.sty'.
